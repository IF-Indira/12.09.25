"""
–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª–Ω–æ—Å–≤—è–∑–Ω–æ–π –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–µ—Ç–∏ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è 
—Ä—ã–Ω–æ—á–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ–¥–µ—Ä–∂–∞–Ω–Ω—ã—Ö –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤
–ê–≤—Ç–æ—Ä—ã: –ò–±—Ä–∞–≥–∏–º–æ–≤–∞ –ò–Ω–¥–∏—Ä–∞, –ö–æ—Ä–æ–ª—å–∫–æ–≤–∞ –ê–ª–∏–Ω–∞
"""

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.model_selection import train_test_split, KFold
from sklearn.preprocessing import StandardScaler, OneHotEncoder
from sklearn.compose import ColumnTransformer
from sklearn.metrics import mean_absolute_error, mean_squared_error, r2_score
import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers, models, callbacks
import warnings
warnings.filterwarnings('ignore')

# ==================== –ê–õ–ì–û–†–ò–¢–ú 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ ====================
def generate_motorcycle_dataset(n_samples=1000):
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤"""
    np.random.seed(42)
    
    # –û—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
    years = np.random.randint(2000, 2023, n_samples)
    mileage = np.random.exponential(20000, n_samples).astype(int) + 1000
    engine_cc = np.random.choice([125, 250, 500, 600, 750, 1000, 1200], n_samples)
    # –°–æ—Å—Ç–æ—è–Ω–∏–µ (1-5 –±–∞–ª–ª–æ–≤)
    condition = np.random.randint(1, 6, n_samples)
    # –ë—Ä–µ–Ω–¥—ã
    brands = np.random.choice(['Honda', 'Yamaha', 'Kawasaki', 'Suzuki', 'BMW', 'Harley'], n_samples)
    # –†–∞—Å—á–µ—Ç –±–∞–∑–æ–≤–æ–π —Ü–µ–Ω—ã
    base_price = (
        (2023 - years) * -500 +  # –ê–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è
        mileage * -0.05 +         # –ü—Ä–æ–±–µ–≥ –≤–ª–∏—è–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ
        engine_cc * 0.8 +         # –û–±—ä–µ–º –¥–≤–∏–≥–∞—Ç–µ–ª—è
        condition * 80000 +       # –°–æ—Å—Ç–æ—è–Ω–∏–µ
        np.random.normal(0, 5000, n_samples)  # –°–ª—É—á–∞–π–Ω—ã–π —à—É–º
    )
    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–º–∏–∏ –∑–∞ –±—Ä–µ–Ω–¥
    brand_premium = {
        'Harley': 20000,
        'BMW': 15000,
        'Honda': 5000,
        'Yamaha': 4000,
        'Kawasaki': 3000,
        'Suzuki': 2000
    }
    
    for i in range(n_samples):
        base_price[i] += brand_premium[brands[i]]
    
    # –ì–∞—Ä–∞–Ω—Ç–∏—è –Ω–∞–ª–∏—á–∏—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–Ω
    prices = np.maximum(base_price, 50000)

    # –°–æ–∑–¥–∞–Ω–∏–µ DataFrame
    df = pd.DataFrame({
        'year': years,
        'mileage': mileage,
        'engine_cc': engine_cc,
        'condition': condition,
        'brand': brands,
        'price': prices
    })
    
    return df

# ==================== –ê–õ–ì–û–†–ò–¢–ú 2: –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö ====================
def preprocess_data(df):
    """–ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö"""
    # –ö–æ–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
    data = df.copy()
    
    # –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∏ —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
    X = data.drop('price', axis=1)
    y = data['price']
    
    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –∏ —á–∏—Å–ª–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
    categorical_features = ['brand']
    numerical_features = ['year', 'mileage', 'engine_cc', 'condition']
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—è
    preprocessor = ColumnTransformer(
        transformers=[
            ('num', StandardScaler(), numerical_features),
            ('cat', OneHotEncoder(drop='first', sparse_output=False), categorical_features)
        ])
    
    # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π
    X_processed = preprocessor.fit_transform(X)
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ One-Hot Encoding
    cat_features_names = preprocessor.named_transformers_['cat'].get_feature_names_out(categorical_features)
    feature_names = numerical_features + list(cat_features_names)
    
    return X_processed, y, preprocessor, feature_names

# ==================== –ê–õ–ì–û–†–ò–¢–ú 3: –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–µ—Ç–∏ ====================
def create_fcn_model(input_shape):
    """–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ—Å–≤—è–∑–Ω–æ–π –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–µ—Ç–∏"""
    model = models.Sequential([
        # –í—Ö–æ–¥–Ω–æ–π —Å–ª–æ–π
        layers.Input(shape=(input_shape,)),
        
        # –°–∫—Ä—ã—Ç—ã–µ —Å–ª–æ–∏
        layers.Dense(64, activation='relu', name='hidden1'),
        layers.Dropout(0.2, name='dropout1'),
        
        layers.Dense(32, activation='relu', name='hidden2'),
        layers.Dropout(0.2, name='dropout2'),
        
        layers.Dense(16, activation='relu', name='hidden3'),
        layers.Dropout(0.1, name='dropout3'),
        
        # –í—ã—Ö–æ–¥–Ω–æ–π —Å–ª–æ–π
        layers.Dense(1, activation='linear', name='output')
    ])
    
    # –ö–æ–º–ø–∏–ª—è—Ü–∏—è –º–æ–¥–µ–ª–∏
    model.compile(
        optimizer=keras.optimizers.Adam(learning_rate=0.001),
        loss='mse',
        metrics=['mae', 'mse']
    )
    
    return model

# ==================== –ê–õ–ì–û–†–ò–¢–ú 4: –ö—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—è ====================
def perform_cross_validation(X, y, n_splits=5, epochs=50):
    """–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏"""
    kfold = KFold(n_splits=n_splits, shuffle=True, random_state=42)
    
    cv_scores = []
    histories = []
    
    for fold, (train_idx, val_idx) in enumerate(kfold.split(X), 1):
        print(f"\n{'='*40}")
        print(f"–û–±—É—á–µ–Ω–∏–µ fold {fold}/{n_splits}")
        print('='*40)
        
        # –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        X_train, X_val = X[train_idx], X[val_idx]
        y_train, y_val = y.iloc[train_idx], y.iloc[val_idx]
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏
        model = create_fcn_model(X_train.shape[1])
        
        # Callbacks
        early_stopping = callbacks.EarlyStopping(
            monitor='val_loss',
            patience=10,
            restore_best_weights=True
        )
        
        # –û–±—É—á–µ–Ω–∏–µ
        history = model.fit(
            X_train, y_train,
            validation_data=(X_val, y_val),
            epochs=epochs,
            batch_size=32,
            callbacks=[early_stopping],
            verbose=0
        )
        
        # –û—Ü–µ–Ω–∫–∞
        val_loss, val_mae, _ = model.evaluate(X_val, y_val, verbose=0)
        cv_scores.append(val_mae)
        histories.append(history)
        
        print(f"Fold {fold}: MAE = {val_mae:.2f}")
    
    print(f"\n–°—Ä–µ–¥–Ω–∏–π MAE –ø–æ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏: {np.mean(cv_scores):.2f} ¬± {np.std(cv_scores):.2f}")
    return cv_scores, histories

# ==================== –ê–õ–ì–û–†–ò–¢–ú 5: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ ====================
def visualize_results(model, X_test, y_test, history, feature_names):
    """–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞–±–æ—Ç—ã –º–æ–¥–µ–ª–∏"""
    fig, axes = plt.subplots(2, 3, figsize=(15, 10))
    axes = axes.flatten()
    # 1. –ì—Ä–∞—Ñ–∏–∫ –ø–æ—Ç–µ—Ä—å
    axes[0].plot(history.history['loss'], label='–û–±—É—á–∞—é—â–∞—è')
    axes[0].plot(history.history['val_loss'], label='–í–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–∞—è')
    axes[0].set_title('–§—É–Ω–∫—Ü–∏—è –ø–æ—Ç–µ—Ä—å (MSE)')
    axes[0].set_xlabel('–≠–ø–æ—Ö–∞')
    axes[0].set_ylabel('Loss')
    axes[0].legend()
    axes[0].grid(True, alpha=0.3)
    # 2. –ì—Ä–∞—Ñ–∏–∫ MAE
    axes[1].plot(history.history['mae'], label='–û–±—É—á–∞—é—â–∞—è')
    axes[1].plot(history.history['val_mae'], label='–í–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–∞—è')
    axes[1].set_title('–°—Ä–µ–¥–Ω—è—è –∞–±—Å–æ–ª—é—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ (MAE)')
    axes[1].set_xlabel('–≠–ø–æ—Ö–∞')
    axes[1].set_ylabel('MAE')
    axes[1].legend()
    axes[1].grid(True, alpha=0.3)
    # 3. –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è vs –†–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    y_pred = model.predict(X_test).flatten()
    axes[2].scatter(y_test, y_pred, alpha=0.6)
    axes[2].plot([y_test.min(), y_test.max()], 
                 [y_test.min(), y_test.max()], 'r--', lw=2)
    axes[2].set_title('–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è vs –†–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è')
    axes[2].set_xlabel('–†–µ–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞')
    axes[2].set_ylabel('–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞')
    axes[2].grid(True, alpha=0.3)
    # 4. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫
    errors = y_pred - y_test
    axes[3].hist(errors, bins=30, edgecolor='black')
    axes[3].axvline(x=0, color='r', linestyle='--')
    axes[3].set_title('–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫')
    axes[3].set_xlabel('–û—à–∏–±–∫–∞')
    axes[3].set_ylabel('–ß–∞—Å—Ç–æ—Ç–∞')
    axes[3].grid(True, alpha=0.3)
    # 5. –í–∞–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è)
    if len(feature_names) <= 10:  # –û–≥—Ä–∞–Ω–∏—á–∏–º –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏
        coefs = model.layers[0].get_weights()[0]
        importance = np.mean(np.abs(coefs), axis=1)
        indices = np.argsort(importance)[-10:]
        
        axes[4].barh(range(len(indices)), importance[indices])
        axes[4].set_yticks(range(len(indices)))
        axes[4].set_yticklabels([feature_names[i] for i in indices])
        axes[4].set_title('–í–∞–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–æ–≤')
        axes[4].set_xlabel('–°—Ä–µ–¥–Ω–∏–π –≤–µ—Å')
    # 6. –û—Å—Ç–∞—Ç–∫–∏
    axes[5].scatter(y_pred, errors, alpha=0.6)
    axes[5].axhline(y=0, color='r', linestyle='--')
    axes[5].set_title('–û—Å—Ç–∞—Ç–∫–∏')
    axes[5].set_xlabel('–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞')
    axes[5].set_ylabel('–û—Å—Ç–∞—Ç–æ–∫')
    axes[5].grid(True, alpha=0.3)
    
    plt.tight_layout()
    plt.savefig('motorcycle_nn_results.png', dpi=150, bbox_inches='tight')
    plt.show()
    # –í—ã–≤–æ–¥ –º–µ—Ç—Ä–∏–∫
    mae = mean_absolute_error(y_test, y_pred)
    rmse = np.sqrt(mean_squared_error(y_test, y_pred))
    r2 = r2_score(y_test, y_pred)
    
    print(f"\n{'='*50}")
    print("–†–ï–ó–£–õ–¨–¢–ê–¢–´ –û–¶–ï–ù–ö–ò –ú–û–î–ï–õ–ò")
    print('='*50)
    print(f"MAE: {mae:.2f} —Ä—É–±.")
    print(f"RMSE: {rmse:.2f} —Ä—É–±.")
    print(f"R¬≤: {r2:.4f}")
    print(f"–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ: {y_test.mean():.2f} —Ä—É–±.")
    print(f"MAE –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã: {(mae/y_test.mean()*100):.2f}%")

# ==================== –û–°–ù–û–í–ù–û–ô –ë–õ–û–ö –í–´–ü–û–õ–ù–ï–ù–ò–Ø ====================
def main():
    print("="*70)
    print("–ü–†–û–ì–ù–û–ó–ò–†–û–í–ê–ù–ò–ï –°–¢–û–ò–ú–û–°–¢–ò –ü–û–õ–¨–ó–û–í–ê–ù–ù–´–• –ú–û–¢–û–¶–ò–ö–õ–û–í")
    print("–ü–æ–ª–Ω–æ—Å–≤—è–∑–Ω–∞—è –Ω–µ–π—Ä–æ–Ω–Ω–∞—è —Å–µ—Ç—å –Ω–∞ TensorFlow")
    print("="*70)
    
    # –®–∞–≥ 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è/–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    print("\n1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞—Ç–∞—Å–µ—Ç–∞ –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤...")
    df = generate_motorcycle_dataset(1000)
    print(f"   –°–æ–∑–¥–∞–Ω–æ {len(df)} –∑–∞–ø–∏—Å–µ–π")
    print(f"   –°—Ç–æ–ª–±—Ü—ã: {list(df.columns)}")
    print(f"   –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:\n{df.head()}")
    
    # –®–∞–≥ 2: –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞
    print("\n2. –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö...")
    X, y, preprocessor, feature_names = preprocess_data(df)
    print(f"   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏: {X.shape[1]}")
    print(f"   –ò–º–µ–Ω–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤: {feature_names}")
    
    # –®–∞–≥ 3: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ train/test
    print("\n3. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫–∏...")
    X_train, X_test, y_train, y_test = train_test_split(
        X, y, test_size=0.2, random_state=42
    )
    print(f"   –û–±—É—á–∞—é—â–∞—è –≤—ã–±–æ—Ä–∫–∞: {X_train.shape[0]} –æ–±—Ä–∞–∑—Ü–æ–≤")
    print(f"   –¢–µ—Å—Ç–æ–≤–∞—è –≤—ã–±–æ—Ä–∫–∞: {X_test.shape[0]} –æ–±—Ä–∞–∑—Ü–æ–≤")
    
    # –®–∞–≥ 4: –ö—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—è
    print("\n4. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏...")
    cv_scores, cv_histories = perform_cross_validation(X_train, y_train, n_splits=5, epochs=100)
    
    # –®–∞–≥ 5: –û–±—É—á–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏
    print("\n5. –û–±—É—á–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏ –Ω–∞ –≤—Å–µ—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö...")
    model = create_fcn_model(X_train.shape[1])
    
    early_stopping = callbacks.EarlyStopping(
        monitor='val_loss',
        patience=15,
        restore_best_weights=True
    )
    
    reduce_lr = callbacks.ReduceLROnPlateau(
        monitor='val_loss',
        factor=0.5,
        patience=5,
        min_lr=1e-6
    )
    
    history = model.fit(
        X_train, y_train,
        validation_split=0.2,
        epochs=150,
        batch_size=32,
        callbacks=[early_stopping, reduce_lr],
        verbose=1
    )
    
    # –®–∞–≥ 6: –û—Ü–µ–Ω–∫–∞ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    print("\n6. –û—Ü–µ–Ω–∫–∞ –º–æ–¥–µ–ª–∏ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö...")
    test_loss, test_mae, _ = model.evaluate(X_test, y_test, verbose=0)
    print(f"   Test MAE: {test_mae:.2f}")
    print(f"   Test Loss: {test_loss:.2f}")
    
    # –®–∞–≥ 7: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
    print("\n7. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...")
    visualize_results(model, X_test, y_test, history, feature_names)
    
    # –®–∞–≥ 8: –ü—Ä–∏–º–µ—Ä –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
    print("\n8. –ü—Ä–∏–º–µ—Ä –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –¥–ª—è –Ω–æ–≤–æ–≥–æ –º–æ—Ç–æ—Ü–∏–∫–ª–∞...")
    
    # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–º–µ—Ä –Ω–æ–≤–æ–≥–æ –º–æ—Ç–æ—Ü–∏–∫–ª–∞
    new_motorcycle = pd.DataFrame({
        'year': [2018],
        'mileage': [15000],
        'engine_cc': [750],
        'condition': [4],
        'brand': ['Yamaha']
    })
    
    # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏
    new_motorcycle_processed = preprocessor.transform(new_motorcycle)
    
    # –î–µ–ª–∞–µ–º –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
    predicted_price = model.predict(new_motorcycle_processed)[0][0]
    
    print(f"   –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –º–æ—Ç–æ—Ü–∏–∫–ª–∞:")
    print(f"   - –ì–æ–¥: 2018")
    print(f"   - –ü—Ä–æ–±–µ–≥: 15,000 –∫–º")
    print(f"   - –û–±—ä–µ–º –¥–≤–∏–≥–∞—Ç–µ–ª—è: 750cc")
    print(f"   - –°–æ—Å—Ç–æ—è–Ω–∏–µ: 4/5")
    print(f"   - –ë—Ä–µ–Ω–¥: Yamaha")
    print(f"   –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞: {predicted_price:,.0f} —Ä—É–±.")
    
    # –®–∞–≥ 9: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
    print("\n9. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏...")
    model.save('motorcycle_price_predictor.h5')
    print("   –ú–æ–¥–µ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∫–∞–∫ 'motorcycle_price_predictor.h5'")
    
    print("\n" + "="*70)
    print("–í–´–ü–û–õ–ù–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û!")
    print("="*70)

# ==================== HTML –ü–†–ò–õ–û–ñ–ï–ù–ò–ï (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ) ====================
def generate_html_app():
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ HTML –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
    html_content = """
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 30px;
            padding: 20px;
            background: #e8f4fd;
            border-radius: 5px;
            display: none;
        }
        .graphs {
            margin-top: 40px;
        }
        .graph-img {
            width: 100%;
            max-width: 600px;
            margin: 10px auto;
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèçÔ∏è –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ–¥–µ—Ä–∂–∞–Ω–Ω—ã—Ö –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤</h1>
        <p>–í–≤–µ–¥–∏—Ç–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –º–æ—Ç–æ—Ü–∏–∫–ª–∞ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –µ–≥–æ —Ä—ã–Ω–æ—á–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏:</p>
        
        <form id="predictionForm">
            <div class="form-group">
                <label>–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞:</label>
                <input type="number" id="year" min="1990" max="2023" value="2018" required>
            </div>
            
            <div class="form-group">
                <label>–ü—Ä–æ–±–µ–≥ (–∫–º):</label>
                <input type="number" id="mileage" min="0" max="1000000" value="15000" required>
            </div>
            
            <div class="form-group">
                <label>–û–±—ä–µ–º –¥–≤–∏–≥–∞—Ç–µ–ª—è (cc):</label>
                <select id="engine_cc" required>
                    <option value="125">125cc</option>
                    <option value="250">250cc</option>
                    <option value="500">500cc</option>
                    <option value="600">600cc</option>
                    <option value="750" selected>750cc</option>
                    <option value="1000">1000cc</option>
                    <option value="1200">1200cc</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>–°–æ—Å—Ç–æ—è–Ω–∏–µ (1-5):</label>
                <select id="condition" required>
                    <option value="1">1 - –ü–ª–æ—Ö–æ–µ</option>
                    <option value="2">2 - –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ</option>
                    <option value="3">3 - –•–æ—Ä–æ—à–µ–µ</option>
                    <option value="4" selected>4 - –û—á–µ–Ω—å —Ö–æ—Ä–æ—à–µ–µ</option>
                    <option value="5">5 - –û—Ç–ª–∏—á–Ω–æ–µ</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>–ë—Ä–µ–Ω–¥:</label>
                <select id="brand" required>
                    <option value="Honda">Honda</option>
                    <option value="Yamaha" selected>Yamaha</option>
                    <option value="Kawasaki">Kawasaki</option>
                    <option value="Suzuki">Suzuki</option>
                    <option value="BMW">BMW</option>
                    <option value="Harley">Harley-Davidson</option>
                </select>
            </div>
            
            <button type="submit">–ü—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å</button>
        </form>
        
        <div class="result" id="result">
            <h2>üí∞ –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: <span id="predictedPrice">-</span> —Ä—É–±.</h2>
            <p>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –º–æ—Ç–æ—Ü–∏–∫–ª–∞:</p>
            <ul>
                <li>–ì–æ–¥: <span id="displayYear">-</span></li>
                <li>–ü—Ä–æ–±–µ–≥: <span id="displayMileage">-</span> –∫–º</li>
                <li>–û–±—ä–µ–º: <span id="displayEngine">-</span> cc</li>
                <li>–°–æ—Å—Ç–æ—è–Ω–∏–µ: <span id="displayCondition">-</span>/5</li>
                <li>–ë—Ä–µ–Ω–¥: <span id="displayBrand">-</span></li>
            </ul>
        </div>
        
        <div class="graphs">
            <h2>–ì—Ä–∞—Ñ–∏–∫–∏ —Ä–∞–±–æ—Ç—ã –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–µ—Ç–∏</h2>
            <p>–ù–∞ –≥—Ä–∞—Ñ–∏–∫–∞—Ö –Ω–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –º–µ—Ç—Ä–∏–∫–∏ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏:</p>
            
            <div>
                <h3>1. –§—É–Ω–∫—Ü–∏—è –ø–æ—Ç–µ—Ä—å</h3>
                <img src="loss_plot.png" alt="–ì—Ä–∞—Ñ–∏–∫ –ø–æ—Ç–µ—Ä—å" class="graph-img">
                <p>–ì—Ä–∞—Ñ–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–Ω–∏–∂–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –Ω–∞ –æ–±—É—á–∞—é—â–µ–π –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–∞—Ö.</p>
            </div>
            
            <div>
                <h3>2. –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è vs –†–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è</h3>
                <img src="predictions_plot.png" alt="–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è" class="graph-img">
                <p>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ü–µ–Ω —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏.</p>
            </div>
        </div>
    </div>
    
    <script>
        document.getElementById('predictionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–æ—Ä–º—ã
            const year = document.getElementById('year').value;
            const mileage = document.getElementById('mileage').value;
            const engine_cc = document.getElementById('engine_cc').value;
            const condition = document.getElementById('condition').value;
            const brand = document.getElementById('brand').value;
            
            // –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã API –≤—ã–∑–æ–≤)
            let basePrice = 100000;
            basePrice += (2023 - year) * 5000; // –ù–æ–≤—ã–µ –¥–æ—Ä–æ–∂–µ
            basePrice -= mileage * 0.1; // –ü—Ä–æ–±–µ–≥ —É–º–µ–Ω—å—à–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å
            basePrice += parseInt(engine_cc) * 100; // –û–±—ä–µ–º —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å
            basePrice += (condition - 3) * 20000; // –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤–ª–∏—è–µ—Ç
            
            // –ü—Ä–µ–º–∏—è –∑–∞ –±—Ä–µ–Ω–¥
            const brandPremium = {
                'Harley': 50000,
                'BMW': 40000,
                'Honda': 20000,
                'Yamaha': 25000,
                'Kawasaki': 15000,
                'Suzuki': 10000
            };
            
            basePrice += brandPremium[brand] || 0;
            
            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã
            const predictedPrice = Math.max(basePrice, 50000);
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            document.getElementById('predictedPrice').textContent = 
                predictedPrice.toLocaleString('ru-RU');
            document.getElementById('displayYear').textContent = year;
            document.getElementById('displayMileage').textContent = 
                parseInt(mileage).toLocaleString('ru-RU');
            document.getElementById('displayEngine').textContent = engine_cc;
            document.getElementById('displayCondition').textContent = condition;
            document.getElementById('displayBrand').textContent = brand;
            
            document.getElementById('result').style.display = 'block';
        });
    </script>
</body>
</html>
    """
    
    with open('motorcycle_price_predictor.html', 'w', encoding='utf-8') as f:
        f.write(html_content)
    print("HTML –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ: 'motorcycle_price_predictor.html'")
    return html_content

# ==================== –¢–û–ß–ö–ê –í–•–û–î–ê ====================
if __name__ == "__main__":
    # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–¥–∞
    main()
    
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    # generate_html_app()
    
    print("\n" + "="*70)
    print("–ü–†–û–ï–ö–¢ –ì–û–¢–û–í!")
